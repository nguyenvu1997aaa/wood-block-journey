"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[829],{640:function(t,e,n){n.r(e),n.d(e,{default:function(){return D}});var r=n(63),a=n(17),u=n(46),o=n.n(u),i=n(66),c=n.n(i),s=n(84),d=n.n(s),p=n(209),l=n.n(p),h=n(64),f=n.n(h),m=n(621),v=n(625),y=n(446),w=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).name="TournamentNotFound",r.message=e||"A Tournament with current context was not found",r.payload=n,r.code="TOURNAMENT_NOT_FOUND",r}return(0,a.Z)(e,t),e}((0,y.Z)(Error)),g=function(t){function e(e,n){var r;return(r=t.call(this,e,n)||this).name="SameContext",r.message=e||"The game attempted to perform a context switch into the current context.",r.code="SAME_CONTEXT",r.payload=n,r}return(0,a.Z)(e,t),e}((0,y.Z)(Error)),x=GameCore.Configs,b=x.LeadersBoard,T=x.Tournament,k=b.LeaderboardId,I=b.Limit,C=T.YourMockTournamentCount,N=function(){function t(t){this.id=void 0,this.title=void 0,this.contextId=void 0,this.payload=void 0,this.endTime=void 0,this.initialScore=void 0,this.id=t,this.title=this.id+"'s Tournament",this.contextId="000-"+this.id,this.initialScore=0,this.payload=c()({playerId:"1213456",playerName:"Player",leaderboardId:k});var e=t>7?7:t;this.endTime=Math.round((Date.now()+864e5*e)/1e3)}var e=t.prototype;return e.getID=function(){return this.id},e.getTitle=function(){return this.title},e.getPayload=function(){return this.payload},e.getEndTime=function(){return this.endTime},e.getContextID=function(){return this.contextId},e.getInitialScore=function(){return this.initialScore},e.setCreatePayload=function(t){var e=t.initialScore,n=t.config,r=t.data;this.initialScore=e,n&&(this.title=n.tournamentTitle),r&&(this.payload=c()(r))},t}(),P=function(t){function e(){var e,n;(n=t.call(this)||this).tournaments=void 0,n.tournamentData=void 0;var r=new N(1);return n.tournaments=[r],n.tournamentData=((e={})[1..toString()]=r,e),n.createYourMockTournaments(),n}(0,a.Z)(e,t);var n=e.prototype;return n.createAsync=function(){var t=(0,r.Z)(o().mark((function t(e){var n=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new(d())((function(t){var r=n.tournaments.length+1,a=new N(r);a.setCreatePayload(e),n.tournaments.push(a),n.tournamentData[r]=a,t(a)})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.shareAsync=function(){var t=(0,r.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new(d())((function(t){return t()})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.joinAsync=function(){var t=(0,r.Z)(o().mark((function t(e){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e in this.tournamentData){t.next=3;break}return t.abrupt("return",this.getPromiseRejectTournamentNotFound());case 3:if(n=this.tournamentData[e],n.getContextID()!==FBInstant.context.getID()){t.next=7;break}return t.abrupt("return",d().reject(new g(null)));case 7:return t.prev=7,t.next=10,this.validateTournament(n);case 10:return t.next=12,GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0);case 12:return t.next=14,FBInstant.context.switchAsync(e);case 14:t.next=19;break;case 16:return t.prev=16,t.t0=t.catch(7),t.abrupt("return",d().reject(t.t0));case 19:return t.abrupt("return",d().resolve());case 20:case"end":return t.stop()}}),t,this,[[7,16]])})));return function(e){return t.apply(this,arguments)}}(),n.validateTournament=function(){var t=(0,r.Z)(o().mark((function t(e){var n,r,a,u,i,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getPayload(),r=JSON.parse(n),a=r.leaderboardId,u=[],t.prev=3,t.next=6,(0,v.H$)(a,{limit:I});case 6:u=t.sent,t.next=12;break;case 9:return t.prev=9,t.t0=t.catch(3),t.abrupt("return",d().reject(t.t0));case 12:if(0!==u.length){t.next=14;break}return t.abrupt("return",this.getPromiseRejectTournamentNotFound());case 14:if(i=window.game.player.getPlayerId(),l()(u).call(u,(function(t){return t.playerId===i}))){t.next=18;break}return t.abrupt("return",this.getPromiseRejectTournamentNotFound());case 18:return c=null,t.prev=19,t.next=22,(0,v.xB)(i,a);case 22:c=t.sent,t.next=28;break;case 25:return t.prev=25,t.t1=t.catch(19),t.abrupt("return",d().reject(t.t1));case 28:if(c){t.next=30;break}return t.abrupt("return",this.getPromiseRejectTournamentNotFound());case 30:return t.abrupt("return",d().resolve());case 31:case"end":return t.stop()}}),t,this,[[3,9],[19,25]])})));return function(e){return t.apply(this,arguments)}}(),n.getPromiseRejectTournamentNotFound=function(){return d().reject(new w(null))},n.postScoreAsync=function(){var t=(0,r.Z)(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d().resolve());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.getTournamentsAsync=function(){var t=(0,r.Z)(o().mark((function t(){var e,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f()(e=[]).call(e,this.tournaments),t.abrupt("return",n);case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.createYourMockTournaments=function(){for(var t=window.game.player.getPlayer(),e=t.playerId,n=t.name,r=0;r<C;r++){var a=1+r+1,u=new N(a);u.setCreatePayload({initialScore:0,config:{tournamentTitle:n+" 's Tournament"},data:{playerId:e,playerName:n,leaderboardId:k}}),this.tournaments.push(u),this.tournamentData[a]=u}},e}(m.J),D=P}}]);